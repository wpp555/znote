(window.webpackJsonp=window.webpackJsonp||[]).push([[40],{588:function(s,a,n){"use strict";n.r(a);var t=n(3),r=Object(t.a)({},(function(){var s=this,a=s.$createElement,n=s._self._c||a;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("h2",{attrs:{id:"前言"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#前言"}},[s._v("#")]),s._v(" 前言")]),s._v(" "),n("ul",[n("li",[s._v("云服务器并不是谁都有，而且带宽低或者流量贵，因此寻找一些免费的大带宽穿透网站 "),n("a",{attrs:{href:"https://www.natfrp.com/",target:"_blank",rel:"noopener noreferrer"}},[s._v("sakurafrp 官网"),n("OutboundLink")],1)]),s._v(" "),n("li",[s._v("免费流量获取有些困难，需要每天登录进行签到获取 1-4GB 流量，远程够用，上传下载临时用用")]),s._v(" "),n("li",[s._v("官方宣称高速流量 为 10Mbps 上行 / 10Mbps 下行，但我实测下载 750KB 左右，上传 160-180KB 晚上 10 点测试，虽然不符，但是比云服务器的 1M（125KB）宽带好太多了")])]),s._v(" "),n("h2",{attrs:{id:"教程"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#教程"}},[s._v("#")]),s._v(" 教程")]),s._v(" "),n("p",[s._v("1.在官网新建隧道，随意选择节点(此次选择#24)")]),s._v(" "),n("p",[s._v("2.n1 盒子是 arm 架构，因此选择"),n("a",{attrs:{href:"https://www.natfrp.com/tunnel/download",target:"_blank",rel:"noopener noreferrer"}},[s._v("Linux (arm64)"),n("OutboundLink")],1),s._v("链接下载")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("wget https://qianqu.me/frp/frpc_linux_arm64\n# 赋予权限\nchmod + x frpc_linux_arm64\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])]),n("p",[s._v("3.尝试一下使用， "),n("code",[s._v("./frpc_linux_arm64")]),s._v(",输入属于自己的密钥后选择一个节点 "),n("em",[s._v("命令行启动只能选择一个节点下的隧道")])]),s._v(" "),n("p",[s._v("4.openwrt 脚本 "),n("code",[s._v("vim /etc/init.d/sakurafrp")]),s._v(","),n("code",[s._v("空格+&")]),s._v(" 异步执行这句命令")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("vim /etc/init.d/sakurafrp\n#!/bin/sh /etc/rc.common\nSTART=99\nSTOP=15\n\nstart() {\n  # 开启 #24下的所有隧道\n  /root/wpp/sakura/frpc_linux_arm64 -f 1234567890:n24\n  # 开启同一节点下的隧道(不是同一节点会报错)\n  # /root/wpp/sakura/frpc_linux_arm64 -f 1234567890:1000,1001,1002 &\n}\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br")])]),n("p",[s._v("5.赋予权限、开机启动")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("chmod + x sakurafrp\n/etc/init.d/sakurafrp enable \t# 开机项\n/etc/init.d/sakurafrp stop\t# 关闭，没写\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])]),n("p",[s._v("6.创建一个脚本"),n("code",[s._v("sakurareboot")]),s._v("，监测是否开启 sakurafrp，未开则启动"),n("code",[s._v("sakurafrp")]),s._v("脚本，有问题，看下一步")]),s._v(" "),n("ul",[n("li",[s._v("监测脚本本身占用进程，必须要去除")]),s._v(" "),n("li",[s._v("后续定时任务也是一个进程，名称不能和监测脚本查询的名称有相同之处")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('#!/bin/sh /etc/rc.common\nSTART=99\nSTOP=15\n\nstart() {\n  RUNNING=`ps | grep frpc_linux_arm64 | grep -v grep`\n  curtime=`date "+%F %H:%M:%S"`\n  if [ "$RUNNING" ]; then\n  # echo $curtime "test start" $RUNNING\n  exit\n  else\n  /etc/init.d/sakurafrp start\n  echo $curtime "sakurafrp starting" >> /root/wpp/sakura/sakurareboot.log\n  fi\n}\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br")])]),n("p",[s._v("chmod + x sakurareboot")]),s._v(" "),n("p",[s._v("7.上一步有问题，如果断电，此定时任务消失,换一种思路，每次执行都要先删除定时任务，然后添加新的定时任务，开机执行此任务即可，所以将第 6 步任务替换")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('#!/bin/sh /etc/rc.common\nSTART=99\nSTOP=15\n\nstart() {\n\n  # 删除定时任务中`sakurareboot`所有行\n  sed -i \'/sakurareboot/d\' /etc/crontabs/root\n\n  # 睡眠3s\n  sleep 3\n\n  # 重新设定任务5分钟执行一次\n  sed -i \'$a */5 * * * *  /etc/init.d/sakurareboot start\' /etc/crontabs/root\n  # 加载任务,使之生效\n  crontab /etc/crontabs/root\n\n  RUNNING=`ps | grep frpc_linux_arm64 | grep -v grep`\n  curtime=`date "+%F %H:%M:%S"`\n  if [ "$RUNNING" ]; then\n  # echo $curtime "test start" $RUNNING\n  exit\n  else\n  /etc/init.d/sakurafrp start\n  echo $curtime "sakurafrp starting" >> /root/wpp/sakura/sakurareboot.log\n  fi\n}\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br")])]),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("\n\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br")])]),n("p",[s._v("8.定时任务，看看")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("vim /etc/crontabs/root\n# 添加脚本\n*/5 * * * *  /etc/init.d/sakurareboot start\n:wq保存退出\n# 加载任务,使之生效\ncrontab /etc/crontabs/root\n# 查看任务\ncrontab -l\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br")])]),n("h2",{attrs:{id:"问题"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#问题"}},[s._v("#")]),s._v(" 问题")]),s._v(" "),n("ol",[n("li",[s._v("由于家里没网，切断电源将近一天，启动发现没有启动"),n("code",[s._v("sakurafrp")]),s._v("(明明设置了开机启动),计划任务也没有了，不知道哪个的问题")])])])}),[],!1,null,null,null);a.default=r.exports}}]);