(window.webpackJsonp=window.webpackJsonp||[]).push([[32],{581:function(s,e,t){"use strict";t.r(e);var n=t(3),a=Object(n.a)({},(function(){var s=this,e=s.$createElement,t=s._self._c||e;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h2",{attrs:{id:"前言"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#前言"}},[s._v("#")]),s._v(" 前言")]),s._v(" "),t("p",[s._v("github 上有一个 webhook 功能，可以让我们在进行操作时发送到指定服务器一个一次性链接，告诉我们，你正在执行一个操作")]),s._v(" "),t("p",[s._v("我们可以用来，在本地 push 到 github 上之后，服务器直接拉取 github 上的代码，然后重新运行服务，完全不需要自己手动操作")]),s._v(" "),t("h2",{attrs:{id:"前题"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#前题"}},[s._v("#")]),s._v(" 前题")]),s._v(" "),t("p",[s._v("1、外网能够访问的服务(云服务器),有域名好记\n2、环境 node、git(启动脚本不需要)\n3、最好使用防火墙，然后 Nginx 转发请求到指定端口")]),s._v(" "),t("h2",{attrs:{id:"实现"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#实现"}},[s._v("#")]),s._v(" 实现")]),s._v(" "),t("p",[s._v("1.根目录新建文件夹 shell，shell 中新建 test.md")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("#!/bin/sh\necho 接收到pull请求\nsleep 3\necho 写入日志到根目录push.log最后一行 >> ./push.log\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("p",[s._v("2.接口信息,get 和 post 各写一个，相同语句(测试 get、github 请求是 post)")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v('router.get(`/sh/:id`, function (req, res) {})\nrouter.post(`/sh/:id`, function (req, res) {\n    const { id } = req.params;\n    var exec = require("child_process").exec; //需要执行的命令字符串\n    var cli = "sh ./shell/" + id + ".sh"; // 执行命令\n    exec(cli, { encoding: "utf8" }, function (err, stdout, stderr) {\n        if (err) {  // 如果抛出错误\n\n            return;\n        }\n        // 如果没有错误,则执行命令成功\n    });\n});\n')])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br")])]),t("p",[s._v("3.启动本地服务 8822(22 端口占用)，"),t("code",[s._v("localhost:8822/sh/test")]),s._v(",即可执行代码，别忘记返回"),t("code",[s._v("res.send")])])])}),[],!1,null,null,null);e.default=a.exports}}]);